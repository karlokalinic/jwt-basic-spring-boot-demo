<!DOCTYPE html>
<html lang="hr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>â˜• Zapisi o Sigurnosti â€” JWT, SQL i Ostale ÄŒarolije</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=Space+Mono:wght@400;700&family=Caveat:wght@500&display=swap" rel="stylesheet">
  <style>
    
    :root {
      --paper: #faf8f3;
      --paper-dark: #f0ebe0;
      --ink: #2c2416;
      --ink-light: #5c4d33;
      --ink-faded: #8b7d5c;
      --accent-red: #c44536;
      --accent-blue: #3d5a80;
      --accent-green: #4a7c59;
      --accent-purple: #6b4c9a;
      --accent-orange: #d4812a;
      --highlight: #fff3b0;
      --code-bg: #1e1e1e;
      --code-text: #d4d4d4;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Crimson Text', Georgia, 'Times New Roman', serif;
      font-size: 19px;
      line-height: 1.75;
      color: var(--ink);
      background: var(--paper);
      background-image: 
        repeating-linear-gradient(
          0deg,
          transparent,
          transparent 31px,
          rgba(0,0,0,0.03) 31px,
          rgba(0,0,0,0.03) 32px
        );
    }

    /* Margine kao u pravoj knjizi */
    .page {
      max-width: 800px;
      margin: 0 auto;
      padding: 60px 40px 120px;
      min-height: 100vh;
      position: relative;
    }

    /* Naslov kao u staroj enciklopediji */
    .masthead {
      text-align: center;
      padding: 40px 0 60px;
      border-bottom: 2px solid var(--ink);
      margin-bottom: 50px;
      position: relative;
    }

    .masthead::after {
      content: 'âœ¦ âœ¦ âœ¦';
      position: absolute;
      bottom: -12px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--paper);
      padding: 0 20px;
      font-size: 12px;
      letter-spacing: 8px;
      color: var(--ink-faded);
    }

    .masthead h1 {
      font-size: 2.8em;
      font-weight: 600;
      letter-spacing: -1px;
      margin-bottom: 8px;
    }

    .masthead .subtitle {
      font-style: italic;
      color: var(--ink-light);
      font-size: 1.1em;
    }

    .dateline {
      font-family: 'Space Mono', monospace;
      font-size: 0.7em;
      color: var(--ink-faded);
      margin-top: 15px;
      letter-spacing: 2px;
    }

    /* Navigacija kao sadrÅ¾aj knjige */
    .toc {
      background: var(--paper-dark);
      border: 1px solid var(--ink-faded);
      padding: 25px 30px;
      margin: 40px 0;
      position: relative;
    }

    .toc::before {
      content: 'SadrÅ¾aj';
      position: absolute;
      top: -12px;
      left: 20px;
      background: var(--paper-dark);
      padding: 0 10px;
      font-variant: small-caps;
      font-size: 0.9em;
      letter-spacing: 2px;
    }

    .toc-list {
      list-style: none;
      columns: 2;
      column-gap: 40px;
    }

    .toc-list li {
      padding: 5px 0;
      border-bottom: 1px dotted var(--ink-faded);
    }

    .toc-list a {
      color: var(--ink);
      text-decoration: none;
      display: flex;
      justify-content: space-between;
    }

    .toc-list a:hover {
      color: var(--accent-red);
    }

    .toc-list .page-num {
      font-family: 'Space Mono', monospace;
      font-size: 0.8em;
    }

    /* Poglavlja */
    .chapter {
      margin: 70px 0;
      padding-top: 30px;
    }

    .chapter-header {
      margin-bottom: 30px;
    }

    .chapter-num {
      font-family: 'Caveat', cursive;
      font-size: 1.4em;
      color: var(--accent-red);
      display: block;
      margin-bottom: 5px;
    }

    .chapter h2 {
      font-size: 1.9em;
      font-weight: 600;
      border-bottom: 3px double var(--ink);
      padding-bottom: 10px;
    }

    .chapter h3 {
      font-size: 1.3em;
      margin: 35px 0 15px;
      color: var(--ink-light);
      font-style: italic;
    }

    /* Tekst stilovi */
    p {
      margin: 20px 0;
      text-align: justify;
      hyphens: auto;
    }

    .first-letter::first-letter {
      float: left;
      font-size: 3.5em;
      line-height: 0.8;
      padding-right: 10px;
      color: var(--accent-red);
      font-weight: 600;
    }

    .highlight {
      background: var(--highlight);
      padding: 2px 5px;
    }

    .note {
      font-style: italic;
      color: var(--ink-light);
    }

    /* Marginalne biljeÅ¡ke */
    .margin-note {
      font-family: 'Caveat', cursive;
      font-size: 0.95em;
      color: var(--accent-purple);
      float: right;
      width: 150px;
      margin: 0 -180px 20px 20px;
      text-align: left;
      line-height: 1.4;
    }

    @media (max-width: 1100px) {
      .margin-note {
        float: none;
        width: 100%;
        margin: 15px 0;
        padding: 10px 15px;
        background: rgba(107, 76, 154, 0.08);
        border-left: 3px solid var(--accent-purple);
      }
    }

    /* Kutije za eksperimente */
    .experiment-box {
      border: 2px solid var(--ink);
      padding: 25px;
      margin: 30px 0;
      position: relative;
      background: white;
    }

    .experiment-box::before {
      content: attr(data-title);
      position: absolute;
      top: -14px;
      left: 15px;
      background: white;
      padding: 0 12px;
      font-family: 'Space Mono', monospace;
      font-size: 0.75em;
      text-transform: uppercase;
      letter-spacing: 2px;
      color: var(--ink-light);
    }

    .experiment-box.danger {
      border-color: var(--accent-red);
      background: #fff9f8;
    }

    .experiment-box.success {
      border-color: var(--accent-green);
      background: #f8fff9;
    }

    .experiment-box.info {
      border-color: var(--accent-blue);
      background: #f8faff;
    }

    /* Kod */
    code {
      font-family: 'Space Mono', monospace;
      font-size: 0.85em;
      background: var(--paper-dark);
      padding: 2px 6px;
      border-radius: 3px;
    }

    pre {
      background: var(--code-bg);
      color: var(--code-text);
      padding: 20px;
      overflow-x: auto;
      font-family: 'Space Mono', monospace;
      font-size: 0.8em;
      line-height: 1.6;
      margin: 20px 0;
      border-left: 4px solid var(--accent-orange);
    }

    pre code {
      background: none;
      padding: 0;
    }

    /* Forme kao u laboratorijskom dnevniku */
    .lab-form {
      background: white;
      border: 1px solid var(--ink-faded);
      padding: 20px;
      margin: 20px 0;
    }

    .lab-form label {
      display: block;
      font-variant: small-caps;
      font-size: 0.85em;
      letter-spacing: 1px;
      margin-bottom: 5px;
      color: var(--ink-light);
    }

    .lab-form input,
    .lab-form textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid var(--ink-faded);
      font-family: 'Space Mono', monospace;
      font-size: 0.9em;
      background: var(--paper);
      margin-bottom: 15px;
    }

    .lab-form input:focus,
    .lab-form textarea:focus {
      outline: none;
      border-color: var(--accent-blue);
      box-shadow: 0 0 0 3px rgba(61, 90, 128, 0.1);
    }

    /* Gumbi kao peÄati */
    .btn {
      display: inline-block;
      padding: 10px 20px;
      border: 2px solid var(--ink);
      background: var(--paper);
      font-family: 'Crimson Text', serif;
      font-size: 1em;
      cursor: pointer;
      transition: all 0.2s;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .btn:hover {
      background: var(--ink);
      color: var(--paper);
    }

    .btn.red { border-color: var(--accent-red); color: var(--accent-red); }
    .btn.red:hover { background: var(--accent-red); color: white; }

    .btn.green { border-color: var(--accent-green); color: var(--accent-green); }
    .btn.green:hover { background: var(--accent-green); color: white; }

    .btn.blue { border-color: var(--accent-blue); color: var(--accent-blue); }
    .btn.blue:hover { background: var(--accent-blue); color: white; }

    /* Disabled gumbi */
    .btn:disabled, .btn.disabled {
      opacity: 0.4;
      cursor: not-allowed;
      background: var(--paper-dark) !important;
      color: var(--ink-faded) !important;
      border-color: var(--ink-faded) !important;
    }

    .btn:disabled:hover, .btn.disabled:hover {
      background: var(--paper-dark) !important;
      color: var(--ink-faded) !important;
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin: 15px 0;
    }

    /* Rezultati kao dnevniÄki zapisi */
    .result-log {
      background: var(--paper-dark);
      border-left: 4px solid var(--accent-orange);
      padding: 15px 20px;
      font-family: 'Space Mono', monospace;
      font-size: 0.8em;
      white-space: pre-wrap;
      max-height: 300px;
      overflow-y: auto;
      margin: 20px 0;
    }

    .result-log:empty::before {
      content: 'â€” Äeka se eksperiment â€”';
      color: var(--ink-faded);
      font-style: italic;
    }

    /* Tablica kao u starim knjigama */
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      font-size: 0.95em;
    }

    th, td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid var(--ink-faded);
    }

    th {
      font-variant: small-caps;
      letter-spacing: 1px;
      border-bottom: 2px solid var(--ink);
    }

    tr:hover td {
      background: var(--highlight);
    }

    /* Dijagram toka kao crteÅ¾ */
    .flow-diagram {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      gap: 10px;
      padding: 30px;
      margin: 25px 0;
      background: white;
      border: 1px dashed var(--ink-faded);
    }

    .flow-step {
      padding: 15px 20px;
      border: 2px solid var(--ink);
      text-align: center;
      background: var(--paper);
      min-width: 100px;
    }

    .flow-step-icon {
      font-size: 1.5em;
      display: block;
      margin-bottom: 5px;
    }

    .flow-step-text {
      font-size: 0.85em;
      font-family: 'Space Mono', monospace;
    }

    .flow-arrow {
      font-size: 1.5em;
      color: var(--ink-faded);
    }

    /* Usporedba dobar/loÅ¡ kod */
    .comparison {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin: 25px 0;
    }

    @media (max-width: 700px) {
      .comparison { grid-template-columns: 1fr; }
    }

    .comparison-side {
      padding: 15px;
      border: 2px solid;
    }

    .comparison-side.bad {
      border-color: var(--accent-red);
      background: #fff5f5;
    }

    .comparison-side.good {
      border-color: var(--accent-green);
      background: #f5fff5;
    }

    .comparison-title {
      font-family: 'Space Mono', monospace;
      font-size: 0.8em;
      text-transform: uppercase;
      letter-spacing: 2px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* Testovi kao checklist */
    .test-list {
      list-style: none;
    }

    .test-item {
      padding: 15px;
      border-bottom: 1px solid var(--ink-faded);
      display: flex;
      gap: 15px;
      align-items: flex-start;
    }

    .test-item:hover {
      background: var(--highlight);
    }

    .test-checkbox {
      width: 20px;
      height: 20px;
      accent-color: var(--accent-green);
      flex-shrink: 0;
      margin-top: 3px;
    }

    .test-info h4 {
      font-size: 1em;
      margin-bottom: 5px;
    }

    .test-info p {
      font-size: 0.9em;
      color: var(--ink-light);
      margin: 0;
      text-align: left;
    }

    .test-tag {
      font-family: 'Space Mono', monospace;
      font-size: 0.7em;
      background: var(--paper-dark);
      padding: 2px 8px;
      margin-left: 10px;
    }

    /* Rezultati testova */
    .test-results-box {
      background: white;
      border: 2px solid var(--ink);
      padding: 20px;
      margin: 20px 0;
    }

    .test-result {
      padding: 10px 15px;
      margin: 10px 0;
      border-left: 4px solid var(--ink-faded);
      font-size: 0.95em;
    }

    .test-result.pass { border-color: var(--accent-green); background: #f8fff8; }
    .test-result.fail { border-color: var(--accent-red); background: #fff8f8; }

    /* Stats */
    .stats-row {
      display: flex;
      gap: 20px;
      margin: 20px 0;
      flex-wrap: wrap;
    }

    .stat {
      text-align: center;
      padding: 15px 25px;
      border: 1px solid var(--ink-faded);
      background: white;
    }

    .stat-num {
      font-size: 2em;
      font-weight: 600;
      display: block;
    }

    .stat-label {
      font-size: 0.8em;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--ink-light);
    }

    .stat.green .stat-num { color: var(--accent-green); }
    .stat.red .stat-num { color: var(--accent-red); }
    .stat.blue .stat-num { color: var(--accent-blue); }

    /* Token display kao artefakt */
    .token-artifact {
      background: var(--code-bg);
      color: var(--code-text);
      padding: 15px;
      font-family: 'Space Mono', monospace;
      font-size: 0.75em;
      word-break: break-all;
      margin: 15px 0;
      position: relative;
    }

    .token-artifact::before {
      content: 'ğŸ« TOKEN';
      position: absolute;
      top: -10px;
      left: 10px;
      background: var(--accent-orange);
      color: white;
      padding: 2px 10px;
      font-size: 0.8em;
    }

    /* Footnotes */
    .footnote {
      font-size: 0.85em;
      color: var(--ink-light);
      border-top: 1px solid var(--ink-faded);
      margin-top: 60px;
      padding-top: 20px;
    }

    .footnote sup {
      color: var(--accent-red);
    }

    /* Dekoracije */
    .ornament {
      text-align: center;
      font-size: 1.5em;
      color: var(--ink-faded);
      margin: 50px 0;
      letter-spacing: 20px;
    }

    /* Handwritten feel */
    .handwritten {
      font-family: 'Caveat', cursive;
      font-size: 1.3em;
      color: var(--accent-purple);
    }

    /* Loading */
    .loading::after {
      content: '...';
      animation: dots 1.5s infinite;
    }

    @keyframes dots {
      0%, 20% { content: '.'; }
      40% { content: '..'; }
      60%, 100% { content: '...'; }
    }

    /* Responsive */
    @media (max-width: 600px) {
      .page { padding: 30px 20px; }
      .masthead h1 { font-size: 2em; }
      .toc-list { columns: 1; }
      .chapter h2 { font-size: 1.5em; }
    }
  </style>
</head>
<body>
  <div class="page">
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         NASLOVNICA
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <header class="masthead">
      <h1>Zapisi o Sigurnosti</h1>
      <p class="subtitle">PraktiÄna enciklopedija za one koji Å¾ele razumjeti kako (ne) zaÅ¡tititi aplikaciju</p>
      <p class="dateline">â˜• Spring Boot â€¢ JWT â€¢ SQL â€¢ Java Serijalizacija</p>
    </header>

    <!-- SadrÅ¾aj -->
    <nav class="toc">
      <ul class="toc-list">
        <li><a href="#poglavlje-1"><span>I. O tokenima i Äarolijama</span><span class="page-num">Â§1</span></a></li>
        <li><a href="#poglavlje-2"><span>II. SQL ubrizgavanje</span><span class="page-num">Â§2</span></a></li>
        <li><a href="#poglavlje-3"><span>III. Serijalizacija objekta</span><span class="page-num">Â§3</span></a></li>
        <li><a href="#poglavlje-4"><span>IV. Testiranje hipoteza</span><span class="page-num">Â§4</span></a></li>
      </ul>
    </nav>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         POGLAVLJE 1: JWT
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <section class="chapter" id="poglavlje-1">
      <div class="chapter-header">
        <span class="chapter-num">Poglavlje Prvo</span>
        <h2>O Tokenima i ÄŒarolijama Autentifikacije</h2>
      </div>

      <p class="first-letter">Zamislite da imate kljuÄ koji dokazuje da ste vi â€” vi. Ne obiÄan kljuÄ, veÄ‡ magiÄnu propusnicu koju server stvara posebno za vas nakon Å¡to dokaÅ¾ete svoj identitet. To je JSON Web Token, ili kako ga mi zovemo â€” JWT.</p>

      <aside class="margin-note">
        Zanimljivost: JWT se Äita kao "dÅ¾ot" prema RFC 7519, ali mnogi kaÅ¾u "dÅ¾ej-dabljuT" i to je OK.
      </aside>

      <p>Token se sastoji od tri dijela odvojena toÄkama: <code>zaglavlje.teret.potpis</code>. Server potpisuje token tajnim kljuÄem, a vi ga nosite sa sobom kao propusnicu na svaki buduÄ‡i zahtjev.</p>

      <div class="flow-diagram">
        <div class="flow-step">
          <span class="flow-step-icon">ğŸ‘¤</span>
          <span class="flow-step-text">login</span>
        </div>
        <span class="flow-arrow">â†’</span>
        <div class="flow-step">
          <span class="flow-step-icon">ğŸ”</span>
          <span class="flow-step-text">provjera</span>
        </div>
        <span class="flow-arrow">â†’</span>
        <div class="flow-step">
          <span class="flow-step-icon">ğŸ«</span>
          <span class="flow-step-text">token</span>
        </div>
        <span class="flow-arrow">â†’</span>
        <div class="flow-step">
          <span class="flow-step-icon">ğŸ“±</span>
          <span class="flow-step-text">spremanje</span>
        </div>
        <span class="flow-arrow">â†’</span>
        <div class="flow-step">
          <span class="flow-step-icon">ğŸ›¡ï¸</span>
          <span class="flow-step-text">pristup</span>
        </div>
      </div>

      <h3>Eksperiment â„–1: Dobivanje tokena</h3>

      <div class="experiment-box info" data-title="Laboratorij">
        <div class="lab-form">
          <label for="user">KorisniÄko ime</label>
          <input type="text" id="user" value="student" placeholder="npr. student ili admin">
          
          <label for="pass">Lozinka</label>
          <input type="password" id="pass" value="pass123" placeholder="tajni niz znakova">
        </div>
        
        <div class="btn-row">
          <button class="btn blue" onclick="login()">ğŸ”‘ Prijavi se</button>
          <button class="btn" onclick="fillAdmin()">ğŸ‘‘ Koristi admin</button>
          <button class="btn" onclick="logout()">ğŸšª Odjava</button>
        </div>

        <p class="note">Dostupni korisnici: <code>student/pass123</code> (obiÄni) ili <code>admin/admin123</code> (administrator)</p>
      </div>

      <h3>VaÅ¡ token (ako ga imate):</h3>
      
      <div class="token-artifact" id="tokenBox">â€” joÅ¡ niste prijavljeni â€”</div>

      <p>Status: <strong id="authStatus">âŒ neprijavljen</strong> Â· Uloge: <span id="roles">â€”</span> Â· IstiÄe: <span id="exp">â€”</span></p>

      <h3>Eksperiment â„–2: Testiranje pristupa</h3>

      <div class="experiment-box" data-title="ZaÅ¡tiÄ‡eni resursi">
        <p>Sada kada imate (ili nemate) token, isprobajmo pristup razliÄitim resursima:</p>
        
        <div class="btn-row">
          <button class="btn" onclick="ping()">ğŸ“ Javni ping</button>
          <button class="btn blue needs-auth" onclick="getNotes()">ğŸ“ Moje biljeÅ¡ke</button>
          <button class="btn red needs-auth" onclick="adminSecret()">ğŸ‘‘ Admin tajna</button>
        </div>

        <p class="note">Javni endpoint radi bez tokena. BiljeÅ¡ke traÅ¾e prijavu. Admin tajna traÅ¾i ROLE_ADMIN.</p>
      </div>

      <div class="experiment-box danger" data-title="Opasan eksperiment">
        <p>Å to ako namjerno pokvarimo token? Promijenimo zadnji znak i vidimo Å¡to Ä‡e server reÄ‡i:</p>
        <button class="btn red needs-auth" onclick="tamper()">ğŸ’¥ Pokvari token</button>
      </div>

      <h3>Zapisnik eksperimenata:</h3>
      <div class="result-log" id="out"></div>
    </section>

    <div class="ornament">â§ â§ â§</div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         POGLAVLJE 2: SQL INJECTION
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <section class="chapter" id="poglavlje-2">
      <div class="chapter-header">
        <span class="chapter-num">Poglavlje Drugo</span>
        <h2>O Opasnosti SQL Ubrizgavanja</h2>
      </div>

      <p class="first-letter">Davno, davno, programeri su gradili upite ovako: spoji korisnikov unos direktno u SQL naredbu. Å to moÅ¾e poÄ‡i po zlu? Pa... sve.</p>

      <aside class="margin-note">
        1998. â€” phrack magazin objavljuje Älanak o SQL injection-u. NapadaÄi se vesele, administratori plaÄu.
      </aside>

      <p>Problem je jednostavan: ako korisnik unese <code>' OR '1'='1</code> kao korisniÄko ime, upit postaje:</p>

      <pre><code>SELECT * FROM users WHERE username = '' OR '1'='1'</code></pre>

      <p>BuduÄ‡i da je <code>'1'='1'</code> uvijek istinito, <span class="highlight">vraÄ‡aju se SVI korisnici</span>. Katastrofa.</p>

      <h3>Usporedba: Ranjivi vs. Sigurni kod</h3>

      <div class="comparison">
        <div class="comparison-side bad">
          <div class="comparison-title">âŒ RANJIVO</div>
          <pre><code>String sql = 
"SELECT * FROM users " +
"WHERE username = '" + 
input + "'";</code></pre>
          <p class="note">Direktna konkatenacija = recept za katastrofu</p>
        </div>
        <div class="comparison-side good">
          <div class="comparison-title">âœ… SIGURNO</div>
          <pre><code>String sql = 
"SELECT * FROM users " +
"WHERE username = ?";
stmt.setString(1, input);</code></pre>
          <p class="note">PreparedStatement escapira specijalne znakove</p>
        </div>
      </div>

      <h3>Eksperiment â„–3: Isprobajte sami</h3>

      <div class="experiment-box danger" data-title="SQL Laboratorij">
        <p style="color: var(--accent-red); margin-bottom: 15px;"><strong>âš ï¸ Kako koristiti:</strong></p>
        <ol>
          <li>Unesite korisniÄko ime u polje (npr. <code>student</code>)</li>
          <li>Kliknite <strong>"ğŸ’‰ Ubaci payload"</strong> da zamijeni s injection stringom <code>' OR '1'='1</code></li>
          <li>Kliknite <strong>"âŒ Ranjivi endpoint"</strong> ili <strong>"âœ… Sigurni endpoint"</strong> da poÅ¡aljete upit</li>
          <li>Rezultati se pojavljuju u tablici ispod</li>
        </ol>

        <div class="lab-form">
          <label for="sqlUser">Upit za korisniÄko ime</label>
          <input type="text" id="sqlUser" value="student" placeholder="npr: student ili ' OR '1'='1">
        </div>

        <div class="btn-row">
          <button class="btn" onclick="fillInjection()">ğŸ’‰ Ubaci payload</button>
          <button class="btn red needs-auth" onclick="sqlVuln()">âŒ Ranjivi endpoint</button>
          <button class="btn green needs-auth" onclick="sqlSafe()">âœ… Sigurni endpoint</button>
        </div>
      </div>

      <h3>Rezultati pretrage:</h3>

      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>KorisniÄko ime</th>
            <th>Uloga</th>
          </tr>
        </thead>
        <tbody id="sqlResults">
          <tr><td colspan="3" class="note" style="text-align:center">â€” pokrenite upit â€”</td></tr>
        </tbody>
      </table>

      <h3>Zapisnik SQL eksperimenata:</h3>
      <div class="result-log" id="sqlLog"></div>

      <div class="experiment-box success" data-title="Lekcija">
        <p><strong>Kako se zaÅ¡tititi?</strong></p>
        <ol>
          <li>Koristite <code>PreparedStatement</code> â€” UVIJEK</li>
          <li>ORM frameworki (Hibernate, JPA) to rade automatski</li>
          <li>Validirajte ulaz â€” whitelist pristup</li>
          <li>Princip minimalnih ovlasti za DB korisnika</li>
        </ol>
        <button class="btn green needs-auth" onclick="fixSqlInjection()">ğŸ›¡ï¸ Demonstriraj zaÅ¡titu</button>
      </div>
    </section>

    <div class="ornament">âœ¦ âœ¦ âœ¦</div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         POGLAVLJE 3: SERIALIZATION
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <section class="chapter" id="poglavlje-3">
      <div class="chapter-header">
        <span class="chapter-num">Poglavlje TreÄ‡e</span>
        <h2>O Serijalizaciji i Njenim Opasnostima</h2>
      </div>

      <p class="first-letter">Java ima ugraÄ‘enu moguÄ‡nost pretvaranja objekata u nizove bajtova â€” serijalizaciju. Obrnuto, deserijalizacija, vraÄ‡a objekt iz bajtova. ZvuÄi korisno, zar ne? Problem nastaje kada deserijalizirate podatke iz nepouzdanog izvora.</p>

      <aside class="margin-note">
        CVE-2015-4852 â€” Jedna od najpoznatijih ranjivosti povezanih s Java deserijalizacijom. Pogodila je WebLogic, JBoss i mnoge druge.
      </aside>

      <p>Kada Java deserijalizira objekt, automatski poziva metodu <code>readObject()</code>. NapadaÄ moÅ¾e stvoriti posebno oblikovane objekte â€” <em>gadget chains</em> â€” koji izvrÅ¡avaju proizvoljni kod prilikom deserijalizacije.</p>

      <h3>Kako izgleda siguran pristup?</h3>

      <div class="flow-diagram">
        <div class="flow-step">
          <span class="flow-step-icon">ğŸ—ï¸</span>
          <span class="flow-step-text">objekt</span>
        </div>
        <span class="flow-arrow">â†’</span>
        <div class="flow-step">
          <span class="flow-step-icon">ğŸ“¤</span>
          <span class="flow-step-text">serialize</span>
        </div>
        <span class="flow-arrow">â†’</span>
        <div class="flow-step">
          <span class="flow-step-icon">âœï¸</span>
          <span class="flow-step-text">HMAC</span>
        </div>
        <span class="flow-arrow">â†’</span>
        <div class="flow-step">
          <span class="flow-step-icon">ğŸ“¥</span>
          <span class="flow-step-text">verify</span>
        </div>
        <span class="flow-arrow">â†’</span>
        <div class="flow-step">
          <span class="flow-step-icon">ğŸ”</span>
          <span class="flow-step-text">whitelist</span>
        </div>
      </div>

      <h3>Eksperiment â„–4: Serijalizacija objekta</h3>

      <div class="experiment-box info" data-title="Serijalizacijski laboratorij">
        <div class="lab-form">
          <label for="serUser">KorisniÄko ime objekta</label>
          <input type="text" id="serUser" value="student">
          
          <label for="serRole">Uloga</label>
          <input type="text" id="serRole" value="ROLE_USER">
          
          <label for="serPassword">Lozinka (transient â€” neÄ‡e se serijalizirati!)</label>
          <input type="password" id="serPassword" value="tajna123">
        </div>

        <button class="btn blue needs-auth" onclick="serializeDemoUser()">ğŸ“¤ Serijaliziraj i potpiÅ¡i</button>
      </div>

      <h3>Serijalizirani payload:</h3>
      
      <div class="lab-form" style="background: var(--paper-dark);">
        <label for="serPayload">Base64 payload</label>
        <textarea id="serPayload" rows="3" placeholder="â€” ovdje Ä‡e se pojaviti serijalizirani podaci â€”"></textarea>
        
        <label for="serSig">HMAC-SHA256 potpis</label>
        <input type="text" id="serSig" placeholder="â€” potpis za verifikaciju integriteta â€”">
      </div>

      <div class="btn-row">
        <button class="btn needs-auth" onclick="loadDeserSamples()">ğŸ“¥ UÄitaj sample</button>
        <button class="btn red" onclick="loadBadGadget()">â˜ ï¸ UÄitaj BadGadget</button>
      </div>

      <h3>Eksperiment â„–5: Deserijalizacija</h3>

      <div class="experiment-box" data-title="Usporedba endpointa">
        <div class="comparison">
          <div class="comparison-side bad">
            <div class="comparison-title">âŒ RANJIVI</div>
            <p>Ignorira potpis, prihvaÄ‡a sve klase</p>
            <button class="btn red needs-auth" onclick="deserRun('vuln')">Deserijaliziraj (vuln)</button>
          </div>
          <div class="comparison-side good">
            <div class="comparison-title">âœ… SIGURNI</div>
            <p>Provjerava HMAC, whitelist klasa</p>
            <button class="btn green needs-auth" onclick="deserRun('safe')">Deserijaliziraj (safe)</button>
          </div>
        </div>
      </div>

      <h3>Rezultat deserijalizacije:</h3>
      <div class="result-log" id="deserOut"></div>

      <div class="experiment-box success" data-title="Å to smo nauÄili">
        <ul>
          <li><strong>transient</strong> â€” oznaÄava polja koja se ne serijaliziraju (npr. lozinke)</li>
          <li><strong>HMAC potpis</strong> â€” osigurava da podaci nisu mijenjani</li>
          <li><strong>Whitelist</strong> â€” dopuÅ¡ta samo poznate, sigurne klase</li>
          <li><strong>Alternativa</strong> â€” koristi JSON umjesto Java serijalizacije</li>
        </ul>
      </div>
    </section>

    <div class="ornament">â—† â—† â—†</div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         POGLAVLJE 4: TESTOVI
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <section class="chapter" id="poglavlje-4">
      <div class="chapter-header">
        <span class="chapter-num">Poglavlje ÄŒetvrto</span>
        <h2>O Testiranju Hipoteza</h2>
      </div>

      <p class="first-letter">Svaka tvrdnja o sigurnosti mora biti potkrijepljena dokazima. U svijetu softvera, ti dokazi su automatski testovi. Ako test prolazi, sigurnosna mjera radi. Ako pada â€” imamo problem.</p>

      <h3>Katalog testova</h3>

      <div class="btn-row">
        <button class="btn blue needs-auth" onclick="loadTestCatalog()">ğŸ“‹ UÄitaj katalog</button>
        <button class="btn" onclick="selectAllTests()">â˜‘ï¸ Odaberi sve</button>
        <button class="btn" onclick="deselectAllTests()">â¬œ PoniÅ¡ti</button>
      </div>

      <ul class="test-list" id="testCatalog">
        <li class="test-item">
          <span class="note">â€” kliknite "UÄitaj katalog" â€”</span>
        </li>
      </ul>

      <h3>Pokretanje testova</h3>

      <div class="experiment-box info" data-title="VaÅ¾no">
        <p><strong>âš ï¸ Trebate JWT token!</strong></p>
        <p>Prije nego pokrenete testove, trebate se prijaviti u <strong>Poglavlju Prvo</strong> kako biste dobili JWT token. Testovi koriste token za autentifikaciju.</p>
      </div>

      <div class="btn-row">
        <button class="btn green needs-auth" onclick="runSelectedTests()">â–¶ï¸ Pokreni odabrane</button>
        <button class="btn blue needs-auth" onclick="runAllTests()">ğŸš€ Pokreni sve</button>
      </div>

      <div class="stats-row" id="testStats" style="display:none;">
        <div class="stat"><span class="stat-num" id="statTotal">0</span><span class="stat-label">ukupno</span></div>
        <div class="stat green"><span class="stat-num" id="statPassed">0</span><span class="stat-label">prolazi</span></div>
        <div class="stat red"><span class="stat-num" id="statFailed">0</span><span class="stat-label">pada</span></div>
        <div class="stat blue"><span class="stat-num" id="statDuration">0</span><span class="stat-label">ms</span></div>
      </div>

      <div class="test-results-box" id="testResultsBox" style="display:none;">
        <h4>Rezultati:</h4>
        <div id="testResults"></div>
      </div>

      <h3>Zapisnik testiranja:</h3>
      <div class="result-log" id="testLog"></div>
    </section>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         FOOTER
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <footer class="footnote">
      <p><sup>â€ </sup> Ovaj projekt je izraÄ‘en u edukativne svrhe. Svi primjeri ranjivog koda su namjerno nesigurni kako bi demonstrirali rizike.</p>
      <p class="handwritten" style="margin-top: 20px;">â€” pisano s â˜• i ljubavlju prema sigurnom kodu â€”</p>
      <p style="margin-top: 15px; font-size: 0.85em; color: var(--ink-faded);">
        Made by Karlo KaliniÄ‡.
        Spring Boot 3.3 Â· JWT (JJWT 0.11.5) Â· H2 Database Â· JUnit 5<br>
        MoÅ¾e se deployati na <a href="https://render.com" style="color: var(--accent-blue);">render.com</a>
      </p>
    </footer>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       JAVASCRIPT
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <script>
    const STORAGE_KEY = "jwt_demo_token";
    let token = localStorage.getItem(STORAGE_KEY) || "";
    let cachedTestCatalog = [];
    let badGadgetPayload = null, badGadgetSig = null;

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Utility
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const $ = id => document.getElementById(id);
    const setOut = (id, txt) => { const el = $(id); if (el) el.textContent = txt; };
    const safeJSON = s => { try { return JSON.parse(s); } catch { return null; } };
    
    function b64urlToJson(b64url) {
      let b64 = b64url.replace(/-/g, "+").replace(/_/g, "/");
      while (b64.length % 4) b64 += "=";
      try { return JSON.parse(atob(b64)); } catch { return null; }
    }

    function updateTokenUI() {
      $("tokenBox").textContent = token || "â€” joÅ¡ niste prijavljeni â€”";
      
      const isLoggedIn = !!token;
      let isExpired = false;
      
      if (!token) {
        $("authStatus").innerHTML = "âŒ neprijavljen";
        $("roles").textContent = "â€”";
        $("exp").textContent = "â€”";
      } else {
        const parts = token.split(".");
        const payload = parts.length >= 2 ? b64urlToJson(parts[1]) : null;
        
        const roles = payload?.rol || [];
        $("roles").textContent = Array.isArray(roles) ? roles.join(", ") : String(roles);
        
        if (payload?.exp) {
          const exp = new Date(payload.exp * 1000);
          isExpired = exp < new Date();
          $("exp").textContent = isExpired ? "âš ï¸ ISTEKAO" : exp.toLocaleString("hr-HR");
        }
        
        $("authStatus").innerHTML = isExpired ? "âš ï¸ token istekao" : "âœ… prijavljen";
        
        // Ako je token istekao, obriÅ¡i ga
        if (isExpired) {
          token = "";
          localStorage.removeItem(STORAGE_KEY);
        }
      }
      
      // Accessibility: OmoguÄ‡i/onemoguÄ‡i gumbe ovisno o prijavi
      const needsAuth = document.querySelectorAll('.needs-auth');
      needsAuth.forEach(btn => {
        btn.disabled = !isLoggedIn || isExpired;
        btn.title = (!isLoggedIn || isExpired) ? "Prvo se prijavite u Poglavlju 1" : "";
      });
    }

    function requireToken(action) {
      if (!token) {
        setOut("out", `âš ï¸ ${action}: TrebaÅ¡ se prvo prijaviti da dobijeÅ¡ token.`);
        return false;
      }
      return true;
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // API
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function api(method, url, body, auth, logId = "out") {
      const headers = {};
      if (body) headers["Content-Type"] = "application/json";
      if (auth && token) headers["Authorization"] = "Bearer " + token;

      // Debug: log request details
      console.log(`[API] ${method} ${url}`, { auth, hasToken: !!token, tokenPreview: token ? token.substring(0, 50) + "..." : "none" });

      try {
        const res = await fetch(url, {
          method,
          headers,
          credentials: "omit",
          body: body ? JSON.stringify(body) : undefined
        });

        const text = await res.text();
        const emoji = res.ok ? "âœ…" : res.status >= 500 ? "ğŸ’¥" : "âš ï¸";
        
        setOut(logId, `${emoji} HTTP ${res.status}\n\n${text || "(prazan odgovor)"}`);
        return { res, text };
      } catch (err) {
        setOut(logId, `ğŸ’¥ GreÅ¡ka: ${err.message}`);
        return { res: null, text: err.message };
      }
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Auth
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function ping() {
      await api("GET", "/api/public/ping", null, false);
    }

    async function login() {
      const u = $("user").value, p = $("pass").value;
      
      // VAÅ½NO: BriÅ¡i stari token PRIJE login-a da izbjegnemo konflikte
      token = "";
      localStorage.removeItem(STORAGE_KEY);
      
      const { res, text } = await api("POST", "/api/auth/login", { username: u, password: p }, false);
      if (res?.ok) {
        const obj = safeJSON(text);
        if (obj?.token) {
          token = obj.token;
          localStorage.setItem(STORAGE_KEY, token);
          updateTokenUI();
          setOut("out", `âœ… UspjeÅ¡na prijava kao "${u}"!\n\nToken spremljen. Sada moÅ¾ete koristiti zaÅ¡tiÄ‡ene endpointe.`);
        }
      }
    }

    function fillAdmin() {
      $("user").value = "admin";
      $("pass").value = "admin123";
    }

    function logout() {
      token = "";
      localStorage.removeItem(STORAGE_KEY);
      updateTokenUI();
      setOut("out", "ğŸšª Odjavljeni ste. Token je obrisan.");
    }

    function tamper() {
      if (!token) return setOut("out", "âš ï¸ Nema tokena za pokvariti.");
      token = token.slice(0, -1) + (token.slice(-1) === "X" ? "Y" : "X");
      localStorage.setItem(STORAGE_KEY, token);
      updateTokenUI();
      setOut("out", "ğŸ’¥ Token je pokvaren (zadnji znak promijenjen).\nProbajte sad pristupiti zaÅ¡tiÄ‡enom endpointu...");
    }

    async function getNotes() {
      await api("GET", "/api/notes", null, true);
    }

    async function adminSecret() {
      await api("GET", "/api/admin/secret", null, true);
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // SQL Injection
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const INJECTION = "' OR '1'='1";

    function fillInjection() {
      $("sqlUser").value = INJECTION;
    }

    async function sqlVuln() {
      if (!requireToken("SQL Vuln")) return;
      const u = $("sqlUser").value;
      setOut("sqlLog", `ğŸ” Å aljem upit: "${u}" na RANJIVI endpoint...`);
      const { res, text } = await api("GET", `/api/sql/vuln?username=${encodeURIComponent(u)}`, null, true, "sqlLog");
      renderSqlResults(text, true, res);
    }

    async function sqlSafe() {
      if (!requireToken("SQL Safe")) return;
      const u = $("sqlUser").value;
      setOut("sqlLog", `ğŸ” Å aljem upit: "${u}" na SIGURNI endpoint...`);
      const { res, text } = await api("GET", `/api/sql/safe?username=${encodeURIComponent(u)}`, null, true, "sqlLog");
      renderSqlResults(text, false, res);
    }

    async function fixSqlInjection() {
      $("sqlUser").value = INJECTION;
      await sqlSafe();
    }

    function renderSqlResults(text, vuln, res) {
      const tbody = $("sqlResults");
      const data = safeJSON(text);
      
      // Debug u log
      const logEl = $("sqlLog");
      if (logEl) {
        let logMsg = res?.ok ? `âœ… HTTP ${res.status}\n` : `âš ï¸ HTTP ${res?.status || '?'}\n`;
        logMsg += `Odgovor: ${text}\n`;
        logMsg += `Parsirano: ${data ? data.length + ' redaka' : 'greÅ¡ka'}`;
        logEl.textContent = logMsg;
      }
      
      if (!Array.isArray(data)) {
        tbody.innerHTML = `<tr><td colspan="3" class="note" style="text-align:center">â€” greÅ¡ka parsiranja: ${text?.substring(0, 100) || 'prazan odgovor'} â€”</td></tr>`;
        return;
      }
      
      if (data.length === 0) {
        tbody.innerHTML = `<tr><td colspan="3" style="text-align:center; color: var(--accent-green);">âœ… 0 rezultata â€” payload tretiran kao literal</td></tr>`;
        return;
      }

      // PrikaÅ¾i SVE rezultate
      let html = data.map(row => `
        <tr ${vuln ? 'style="background: #fff0f0;"' : ''}>
          <td>${row.id ?? row.ID ?? "?"}</td>
          <td>${row.username ?? row.USERNAME ?? "?"}</td>
          <td>${row.role ?? row.ROLE ?? "?"}</td>
        </tr>
      `).join("");

      if (vuln && data.length > 1) {
        html += `<tr><td colspan="3" style="text-align:center; color: var(--accent-red); font-weight: bold;">âš ï¸ SQL INJECTION USPJEÅ AN! VraÄ‡eno ${data.length} korisnika umjesto 1!</td></tr>`;
      }
      
      tbody.innerHTML = html;
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Serialization
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function serializeDemoUser() {
      if (!requireToken("Serijalizacija")) return;
      
      const payload = {
        username: $("serUser").value,
        role: $("serRole").value,
        password: $("serPassword").value
      };

      const { res, text } = await api("POST", "/api/deser/serialize", payload, true, "deserOut");
      const data = safeJSON(text);
      
      if (res?.ok && data) {
        $("serPayload").value = data.payloadBase64 || "";
        $("serSig").value = data.sigBase64 || "";
      }
    }

    async function loadDeserSamples() {
      if (!requireToken("Deser Samples")) return;
      
      const { res, text } = await api("GET", "/api/deser/samples", null, true, "deserOut");
      const data = safeJSON(text);
      
      if (res?.ok && Array.isArray(data)) {
        const good = data.find(x => x.name.startsWith("GOOD"));
        const bad = data.find(x => x.name.startsWith("BAD"));
        
        if (good) {
          $("serPayload").value = good.payloadBase64;
          $("serSig").value = good.sigBase64;
        }
        if (bad) {
          badGadgetPayload = bad.payloadBase64;
          badGadgetSig = bad.sigBase64;
        }
        setOut("deserOut", "âœ… GOOD sample uÄitan. BAD gadget spreman.");
      }
    }

    function loadBadGadget() {
      if (!badGadgetPayload) {
        setOut("deserOut", "âš ï¸ Prvo uÄitaj sample da dobijeÅ¡ BadGadget payload.");
        return;
      }
      $("serPayload").value = badGadgetPayload;
      $("serSig").value = badGadgetSig;
      setOut("deserOut", "â˜ ï¸ BadGadget payload uÄitan. VULN Ä‡e ga izvrÅ¡iti, SAFE Ä‡e odbiti.");
    }

    async function deserRun(mode) {
      if (!requireToken("Deserijalizacija")) return;
      
      const payload = $("serPayload").value.trim();
      const sig = $("serSig").value.trim();
      
      if (!payload) {
        setOut("deserOut", "âš ï¸ Payload je prazan. Serijalizirajte objekt ili uÄitajte sample.");
        return;
      }

      const { res, text } = await api("POST", `/api/deser/${mode}`, { payloadBase64: payload, sigBase64: sig }, true, "deserOut");
      const data = safeJSON(text);
      
      if (data) {
        const emoji = data.ok ? (mode === 'vuln' ? 'âš ï¸' : 'âœ…') : 'âŒ';
        let output = `${emoji} Deserijalizacija [${mode.toUpperCase()}]\n\n`;
        output += `Klasa: ${data.deserializedClass}\n`;
        output += `SadrÅ¾aj: ${data.deserializedSummary}\n`;
        
        if (data.badGadgetTriggerCount > 0) {
          output += `\nâ˜ ï¸ BadGadget triggeran ${data.badGadgetTriggerCount}x!\n`;
          output += `Events: ${JSON.stringify(data.badGadgetEvents)}`;
        }
        
        setOut("deserOut", output);
      }
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Tests
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function loadTestCatalog() {
      if (!requireToken("Test Katalog")) return;
      
      const container = $("testCatalog");
      container.innerHTML = '<li class="test-item"><span class="note loading">UÄitavam</span></li>';

      const { res, text } = await api("GET", "/api/tests/catalog", null, true, "testLog");
      const data = safeJSON(text);
      
      if (!res?.ok || !Array.isArray(data)) {
        container.innerHTML = '<li class="test-item"><span style="color:var(--accent-red)">âŒ GreÅ¡ka uÄitavanja</span></li>';
        return;
      }

      cachedTestCatalog = data;
      
      container.innerHTML = data.map(test => `
        <li class="test-item">
          <input type="checkbox" class="test-checkbox" data-test-id="${test.id}" checked>
          <div class="test-info">
            <h4>${test.title} <span class="test-tag">${test.group}</span></h4>
            <p>${test.description}</p>
          </div>
        </li>
      `).join("");
    }

    function selectAllTests() {
      document.querySelectorAll("#testCatalog .test-checkbox").forEach(cb => cb.checked = true);
    }

    function deselectAllTests() {
      document.querySelectorAll("#testCatalog .test-checkbox").forEach(cb => cb.checked = false);
    }

    function getSelectedTestIds() {
      return Array.from(document.querySelectorAll("#testCatalog .test-checkbox:checked"))
        .map(el => el.getAttribute("data-test-id"));
    }

    async function runSelectedTests() {
      if (!requireToken("JUnit Tests")) return;
      const ids = getSelectedTestIds();
      if (ids.length === 0) {
        setOut("testLog", "âš ï¸ Nema odabranih testova.");
        return;
      }
      await runTests(ids);
    }

    async function runAllTests() {
      if (!requireToken("JUnit Tests")) return;
      await runTests([]);
    }

    async function runTests(ids) {
      if (!requireToken("Pokretanje testova")) return;

      $("testResults").innerHTML = '<span class="note loading">IzvrÅ¡avam</span>';
      $("testResultsBox").style.display = "block";
      $("testStats").style.display = "none";

      const payload = ids.length ? { testIds: ids } : {};
      const { res, text } = await api("POST", "/api/tests/run", payload, true, "testLog");
      const data = safeJSON(text);
      
      if (!res?.ok || !data) {
        $("testResults").innerHTML = '<span style="color:var(--accent-red)">âŒ GreÅ¡ka izvrÅ¡avanja (HTTP ' + (res?.status || '?') + '). Provjerite jeste li se prijavili!</span>';
        return;
      }

      $("testStats").style.display = "flex";
      $("statTotal").textContent = data.total || 0;
      $("statPassed").textContent = data.passed || 0;
      $("statFailed").textContent = data.failed || 0;
      $("statDuration").textContent = data.durationMs || 0;

      const results = data.results || [];
      $("testResults").innerHTML = results.map(r => {
        const status = r.status || "UNKNOWN";
        const cls = status === "SUCCESSFUL" ? "pass" : "fail";
        const icon = status === "SUCCESSFUL" ? "âœ…" : "âŒ";
        
        return `<div class="test-result ${cls}">
          ${icon} <strong>${r.title || r.id}</strong> â€” ${r.durationMs}ms
          ${r.failureMessage ? `<br><small style="color:var(--accent-red)">${r.failureMessage}</small>` : ''}
        </div>`;
      }).join("");
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Init
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    document.addEventListener('DOMContentLoaded', () => {
      updateTokenUI();
    });
  </script>
</body>
</html>
